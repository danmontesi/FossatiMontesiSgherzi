\h
CREATE TABLE user_token (token_id serial PRIMARY KEY, value VARCHAR (100) UNIQUE NOT NULL, expiry_date TIME NOT NULL)
SELECT * FROM pg_catalog.pg_tables;
SELECT * FROM pg_catalog.pg_tables;
SELECT * FROM pg_catalog.pg_tables;
SELECT * FROM pg_catalog.pg_tables WHERE schemaname = 'user_token';
SELECT * FROM pg_catalog.pg_tables
CREATE TABLE user_token (token_id serial PRIMARY KEY, value VARCHAR (100) UNIQUE NOT NULL, expiry_date TIME NOT NULL);
CREATE TABLE user_token (token_id serial PRIMARY KEY, value VARCHAR (100) UNIQUE NOT NULL, expiry_date TIME NOT NULL);
SELECT * FROM pg_catalog.pg_tables WHERE schemaname = 'user_token';
SELECT * FROM pg_catalog.pg_tables;
SELECT * FROM pg_catalog.pg_tables WHERE tablename = 'user_token';
CREATE TABLE account ()
CREATE TABLE account (id serial PRIMARY KEY, email VARCHAR(100) NOT NULL, password VARCHAR(100) NOT NULL, verified BOOLEAN NOT NULL);
CREATE TABLE account (id serial PRIMARY KEY, email VARCHAR(100) NOT NULL, password VARCHAR(100) NOT NULL, verified BOOLEAN NOT NULL);
SELECT * FROM pg_catalog.pg_tables WHERE tablename = 'account';
ALTER TABLE user_token ADD COLUMN user_id serial REFERENCES account (id)
SELECT * FROM pg_catalog.pg_tables WHERE tablename = 'user_token';
SELECT * FROM pg_catalog.pg_tables WHERE tablename = 'user_token';
SELECT * FROM pg_catalog.pg_tables WHERE tablename = 'account';
\d+ account
\d+ user_token
DROP TABLE user_token
\d+ user_token
DROP TABLE user_token;
DROP TABLE user_token;
\d+ user_token
CREATE TABLE user_token (id serial PRIMARY KEY, user_id serial REFERENCES account(id), value VARCHAR (100) UNIQUE NOT NULL, expiry_date TIME NOT NULL);
\d+ user_token
CREATE TABLE individual_account (SSN VARCHAR(16) PRIMARY KEY, username VARCHAR(100) UNIQUE NOT NULL, name VARCHAR(100) UNIQUE NOT NULL, surname VARCHAR(100) UNIQUE NOT NULL, birth_date: DATE, automated_sos: BOOLEAN NOT NULL DEFAULT false) INHERITS account;
CREATE TABLE individual_account (SSN VARCHAR(16) PRIMARY KEY, username VARCHAR(100) UNIQUE NOT NULL, name VARCHAR(100) UNIQUE NOT NULL, surname VARCHAR(100) UNIQUE NOT NULL, birth_date DATE, automated_sos BOOLEAN NOT NULL DEFAULT false) INHERITS account;
CREATE TABLE individual_account (SSN VARCHAR(16) PRIMARY KEY, username VARCHAR(100) UNIQUE NOT NULL, name VARCHAR(100) UNIQUE NOT NULL, surname VARCHAR(100) UNIQUE NOT NULL, birth_date DATE, automated_sos BOOLEAN NOT NULL DEFAULT false) INHERITS account;
CREATE TABLE individual_account (SSN VARCHAR(16) PRIMARY KEY, username VARCHAR(100) UNIQUE NOT NULL, name VARCHAR(100) UNIQUE NOT NULL, surname VARCHAR(100) UNIQUE NOT NULL, birth_date DATE, automated_sos BOOLEAN NOT NULL DEFAULT false) INHERITS account;
CREATE TABLE individual_account (SSN VARCHAR(16) PRIMARY KEY, username VARCHAR(100) UNIQUE NOT NULL, name VARCHAR(100) UNIQUE NOT NULL, surname VARCHAR(100) UNIQUE NOT NULL, birth_date DATE, automated_sos BOOLEAN NOT NULL DEFAULT false) INHERITS (account);
\d+ individual_account
\d+ user_token
\d+ account
ALTER TABLE account ADD CONSTRAINT UNIQUE email;
ALTER TABLE account ADD UNIQUE email;
ALTER TABLE account ADD CONSTRAINT UNIQUE (email);
ALTER TABLE account ADD UNIQUE (email);
\d+ account
\d+ account
\d+ user_token 
\d+ individual_account
CREATE TABLE individual_account (company_name VARCHAR(100) UNIQUE NOT NULL) INHERITS (account)
;
CREATE TABLE company_account (company_name VARCHAR(100) UNIQUE NOT NULL) INHERITS (account);
;
CREATE TABLE run_organizer_account (name VARCHAR(100) NOT NULL, surname VARCHAR(100) NOT NULL) INHERITS (account);
\d+ run_organizer_account
CREATE TABLE user_data (
user_id PRIMARY KEY REFERENCES individual_account(id),
timestamp TIMESTAMP NOT NULL
id serial PRIMARY KEY
);
CREATE TABLE user_data (,
timestamp TIMESTAMP NOT NULL,
id serial PRIMARY KEY,user_id PRIMARY KEY REFERENCES individual_account(id),
);
CREATE TABLE user_data (
id serial PRIMARY KEY, timestamp TIMESTAMP NOT NULL,
user_id PRIMARY KEY REFERENCES individual_account(id),
);
CREATE TABLE user_data (
id serial PRIMARY KEY, timestamp TIMESTAMP NOT NULL,
user_id REFERENCES individual_account(id),
);
CREATE TABLE user_data (
id serial PRIMARY KEY,
timestamp TIMESTAMP,
user_id REFERENCES individual_account (id)
);
CREATE TABLE user_data (
id serial PRIMARY KEY,
timestamp TIMESTAMP,
user_id serial REFERENCES individual_account (id)
);
ALTER TABLE individual_account ADD CONSTRAINT UNIQUE (id)
;
ALTER TABLE individual_account ADD UNIQUE (id)
;
CREATE TABLE user_data (
id serial PRIMARY KEY,
timestamp TIMESTAMP,
user_id serial REFERENCES individual_account (id)
);
ALTER TABLE individual_account ADD PRIMARY KEY (id)
;
\d+ individual_account
CREATE TABLE heart_rate (
bpm INTEGER NOT NULL
) INHERITS (user_data);
CREATE TABLE accelerometer (
acc_x FLOAT NOT NULL, 
acc_y  FLOAT NOT NULL, 
acc_z  FLOAT NOT NULL) INHERITS (user_data)
;
CREATE TABLE gps_coordinates(
lat FLOAT NOT NULL,
long FLOAT NOT NULL
); INHERITS (user_data)
\d+ individual_account
\d+ company_account
\d+ company_account
\d+ individual_account
\d+ company_account
\d+ run_organizer_accountt
\d+ run_organizer_account
\d+ run_organizer_account
\d+ run_organizer_account
UPDATE individual_account SET verified=false WHERE email='francesco.sgherzi@gmail.com';
SELECT * FROM individual_account;
UPDATE individual_account SET verified=true WHERE email='francesco.sgherzi@gmail.com';
select * from user_token;
\d+ gps_coordinates
\d+ heart_rate
\d+ accelerometer
DROP TABLE gps_coordinates
;
CREATE TABLE gps_coordinates (
lat FLOAT NOT NULL,
long FLOAT NOT NULL
) INHERITS (user_data);
\d+ gps_coordinates
\d+ user_data
\d+ gps_coordinates
\d+ accelerometer
\d+ heart_rate
SELECT * FROM heart_rate;
SELECT * FROM accelerometer;
SELECT * FROM gps_coordinates;
SELECT * FROM gps_coordinates;
DELETE FROM gps_coordinates;
DELETE FROM heart_rate;
DELETE FROM accelerometer;
SELECT * FROM gps_coordinates;
DELETE FROM gps_coordinates;
DELETE FROM accelerometer;
DELETE FROM heart_rate;
DELETE FROM accelerometer;
DELETE FROM heart_rate;
DELETE FROM gps_coordinates;
\d+ accelerometer
DELETE FROM gps_coordinates;
DELETE FROM heart_rate;
DELETE FROM accelerometer;
DELETE FROM individual_user;
DELETE FROM individual_account;
DELETE FROM company_account;
DELETE FROM run_organizer_account;
ALTER TABLE individual_account ADD COLUMN username VARCHAR(100) UNIQUE NOT NULL;
ALTER TABLE run_organizer_account ADD COLUMN username VARCHAR(100) UNIQUE NOT NULL;
ALTER TABLE company_account ADD COLUMN username VARCHAR(100) UNIQUE NOT NULL;
SELECT * FROM  individual_user;
SELECT * FROM  individual_account;
DELETE FROM individual_account;
DELETE FROM user_token
;
DELETE FROM individual_account;
DELETE FROM run_organizer_account;
DELETE FROM company_account;
DELETE FROM user_token;
ALTER TABLE individual_account DROP COLUMN username;
ALTER TABLE run_organizer_account DROP COLUMN username;
ALTER TABLE company_account DROP COLUMN username;
DELETE FROM individual_account WHERE email='francesco.sgherzi@gmail.com';
SELECT * FROM gps_data;
SELECT * FROM gps_coordinates;
DELETE FROM gps_coordinates;
DELETE FROM heart_rate;
DELETE FROM accelerometer;
SELECT * FROM heart_rate ;
ls
;
SELECT * FROM gps_coordinates WHERE user_id <> 45;
SELECT * FROM gps_coordinates WHERE user_id <> 45;
SELECT * FROM gps_coordinates WHERE user_id <> 45;
SELECT * FROM gps_coordinates WHERE user_id <> 45;
SELECT * FROM gps_coordinates WHERE user_id = 45;
SELECT * FROM gps_coordinates WHERE user_id = 45;
SELECT * FROM accelerometer WHERE user_id = 45;
DELETE FROM individual_account WHERE email='francesco.sgherzi@gmail.com';
SELECT * FROM individual_account ;
SELECT * FROM individual_account WHERE email='francesco.sgherzi@gmail.com';
SELECT * FROM individual_account WHERE email='francesco.sgherzi@gmail.com';
SELECT * FROM accelerometer WHERE id=62;
SELECT * FROM accelerometer;
SELECT * FROM accelerometer;
SELECT * FROM individual_account WHERE email='francesco.sgherzi@gmail.com';
SELECT * FROM accelerometer;
DELETE FROM accelerometer;
DELETE FROM gps_coordinates;
DELETE FROM heart_rate;
SELECT * FROM accelerometer;
SELECT * FROM individual_account WHERE email='francesco.sgherzi@gmail.com';
SELECT * FROM accelerometer:
;
SELECT * FROM accelerometer
;
SET SESSION TIME ZONE 'Europe/Rome';
SELECT * FROM accelerometer
;
SELECT * FROM accelerometer;
\d+ gps_coordinates
CREATE TABLE individual_query (
id INTEGER PRIMARY KEY, 
SSN char(16) NOT NULL, 
authorization INTEGER NOT NULL
);
\d accelerometer 
SELECT * from accelerometer 
;
\d query
\d age_query
\d individual_query
\d radius_queryy
\d radius_query
ALTER TABLE radius_query ADD COLUMN id INTEGER PRIMARY KEY;
\d radius_query
ALTER TABLE query ADD COLUMN valid BOOLEAN NOT NULL DEFAULT false;
\d query
DELETE FROM query 
;
ALTER TABLE query ADD COLUMN type VARCHAR(20) NOT NULL;
ALTER TABLE query ADD COLUMN type VARCHAR(20) NOT NULL;
ALTER TABLE query ADD COLUMN type VARCHAR(20) NOT NULL;
ALTER TABLE query ADD COLUMN type_query VARCHAR(20) NOT NULL;
SELECT * from *;
SELECT * from query;
ALTER TABLE query ADD COLUMN query_type VARCHAR(20) NOT NULL;
DROP TABLE query;
ALTER TABLE query ADD COLUMN query_type VARCHAR(20) NOT NULL;
\d subscription_type
SELECT * FROM company_account WHERE email = 'dd@me.it';
SELECT * FROM company_account WHERE email = 'dan@me.it';
\d run
SELECT * FROM run;
\d+ gps_coordinates 
SELECT * FROM run;
SELECT * FROM run;
\d run
SELECT * FROM run WHERE id = 64;
SELECT * FROM run;
SELECT * FROM run WHERE id = 59;
SELECT * FROM run WHERE id = 60;
ALTER TABLE run DROP COLUMN status;
\d run
SELECT * FROM run WHERE id = 60;
\d run_subscription
\d gps_coordinates 
SELECT * FROM run_subscription ;
DELETE FROM run_subscription 
;
SELECT table_name
  FROM information_schema.tables
 WHERE table_schema='public';
SELECT table_name
  FROM information_schema.tables
 WHERE table_schema='public'
AND table_name LIKE '%_query';
SELECT table_name
  FROM information_schema.tables
 WHERE table_schema='public'
AND table_name LIKE '%query';
DROP TABLE age_query ;
DROP TABLE city_query;
SELECT table_name
  FROM information_schema.tables
 WHERE table_schema='public'
AND table_name LIKE '%query';
SELECT * FROM query;
DELETE FROM query;
SELECT * FROM query;
SELECT * FROM regional_query;
DELETE FROM regional_query ;
DELETE FROM individual_query;
DELETE FROM individual_query;
DELETE FROM regional_query ;
DELETE FROM radius_query ;
\d gps_coordinates
\d heart_rate
\d gps_coordinates
\d accelerometer 
SELECT * FROM individual_account as ia LEFT JOIN accelerometer as acc ON ia.id = acc.user_id LEFT JOIN heart_rate as hr ON ia.id = hr.user_id LEFT JOIN gps_coordinates as gc ON ia.id = gc.user_id;
SELECT * FROM individual_account as ia LEFT JOIN accelerometer as acc ON ia.id = acc.user_id LEFT JOIN heart_rate as hr ON ia.id = hr.user_id LEFT JOIN gps_coordinates as gc ON ia.id = gc.user_id;
ALTER TABLE regional_query ADD COLUMN additional_params json NOT NULL;
ALTER TABLE radius_query ADD COLUMN additional_params json NOT NULL;
\d radius_query
\d regional_query
ALTER TABLE individual_query ADD COLUMN additional_params json NOT NULL;
SELECT * FROM individual_account;
SELECT * FROM individual_account;
CREATE TABLE query_user(
user_id integer PRIMARY KEY,
query_id integer PRIMARY KEY
);
CREATE TABLE query_user(
user_id integer,
query_id integer,
PRIMARY KEY (user_id, query_id));
\d query_user
\d query
\d company_account
SELECT * FROM individual_account;
SELECT * FROM query;
SELECT * FROM individual_query;
SELECT * FROM query;
SELECT * FROM individual_user;
SELECT * FROM individual_user;
SELECT * FROM individual_account;
INSERT INTO query_user(user_id, query_id) VALUES(62,63) RETURNING *;
SELECT ca.email 
FROM query_user as qu, query as q, company_account as ca
WHERE qu.user_id = 62 AND qu.query_id = q.id AND q.company_id = ca.id;
\d query_user
SELECT * FROM query_user ;
\d query
SELECT * FROM individual_query;
SELECT * FROM individual_query;
SELECT * from individual_account AS ia, individual_query AS iq WHERE iq.id = 93 AND iq.SSN = ia.SSN;
SELECT * FROM individual_account
;
SELECT * FROM individual_account AS ia, individual_query AS iq WHERE iq.id = 93 AND iq.SSN = ia-ssn;
SELECT * FROM individual_account AS ia, individual_query AS iq WHERE iq.id = 93 AND iq.SSN = ia.ssn;
\d individual_query
\d individual_query
\query
\d query
\d company_account
SELECT * FROM individual_account ;
SELECT * FROM individual_account ;
SELECT * FROM user_token;
\d individual_account
DELETE FROM run_organizer_account WHERE email='10493184@polimi.it';
DELETE FROM run_organizer_account WHERE email='10493184@polimi.it';
DELETE FROM run_organizer_account WHERE email='10493184@polimi.it';
DELETE FROM run_organizer_account WHERE email='10493184@polimi.it';
DELETE FROM run_organizer_account WHERE email='10493184@polimi.it';
DELETE FROM run_organizer_account WHERE email='10493184@polimi.it';
DELETE FROM company_account WHERE email='francesco.sgherzi.dev@gmail.com';
SELECT * individual_query;
SELECT * FROM individual_query;
SELECT * FROM individual_query;
SELECT * FROM individual_query;
\d run_subscription
SELECT * FORM individual_user
;
SELECT * FROM individual_user
;
SELECT * FROM individual_account
;
INSERT INTO run_subscription(run_id,user_id,subscription_date) VALUES(62,52,'2019-01-07')
;
SELECT * FROM run_subscription ;
SELECT * FROM individual_account
;
INSERT INTO run_subscription(run_id,user_id,subscription_date) VALUES(62,59,'2019-01-07')
;
\d run_subscription 
\d individual_account
SELECT * FROM individual_account WHERE id = 59;
SELECT * FROM run_subscription ;
SELECT rs.run_id, rs.user_id, rs.subscription_date, ia.name, ia.surname FROM run_subscription as rs, individual_account as ia WHERE rs.run_id = 62 AND rs.run_id = ia.id;
SELECT rs.run_id, rs.user_id, rs.subscription_date, ia.name, ia.surname, ia.id FROM run_subscription as rs, individual_account as ia WHERE rs.run_id = 62 AND rs.run_id = ia.id;
SELECT rs.run_id, rs.user_id, rs.subscription_date, ia.name, ia.surname, ia.id FROM run_subscription as rs, individual_account as ia WHERE rs.run_id = 62 AND rs.user_id = ia.id;
INSERT INTO run_subscription VALUES();)
SELECT * FROM individual_user;
SELECT * FROM individual_account;
INSERT INTO run_subscription(run_id, user_id, subscriprtion_date) VALUES(62,62,'2019-01-07');
INSERT INTO run_subscription(run_id, user_id, subscription_date) VALUES(62,62,'2019-01-07');
SELECT * from individual_query ;
SELECT * from individual_query ;
SELECT * from query where id = 112 ;
select * from company_account where id = 98
;
SELECT * from individual_query ;
select * from individual_account ;
SELECT * from query_user ;
SELECT * from query_user ;
SELECT * from query_user ;
SELECT * FROM individual_query where id = 114
;
SELECT * FROM individual_query where id = 114
;
\d individual_account
\d individual_query
SELECT * FROM individual_query WHERE id = 93;
\d user_query
\d query_user
SELECT * FROM user_query;
SELECT * FROM query_user;
\d gps_coordinates 
 SELECT * FROM query_user as qu, individual_account as ia, gps_coordinates as gc, heart_rate as hr, accelerometer as aWHERE ia.id = qu.user_id AND qu.query_id = $1 AND qu.user_id = gc.user_id AND qu.user_id = a.user_id AND qu.user_id = hr.user_id
;
 SELECT * FROM query_user as qu, individual_account as ia, gps_coordinates as gc, heart_rate as hr, accelerometer as aWHERE ia.id = qu.user_id AND qu.query_id = 114 AND qu.user_id = gc.user_id AND qu.user_id = a.user_id AND qu.user_id = hr.user_id
;
 SELECT * FROM query_user as qu, individual_account as ia, gps_coordinates as gc, heart_rate as hr, accelerometer as a WHERE ia.id = qu.user_id AND qu.query_id = 114 AND qu.user_id = gc.user_id AND qu.user_id = a.user_id AND qu.user_id = hr.user_id
;
 SELECT * FROM query_user as qu, individual_account as ia, gps_coordinates as gc, heart_rate as hr, accelerometer as a WHERE ia.id = qu.user_id AND qu.query_id = 114 AND qu.user_id = gc.user_id AND qu.user_id = a.user_id AND qu.user_id = hr.user_id;
\d individual_account
\d individual_query
SELECT * FROM query_user;
SELECT * FROM radius_query;
SELECT * FROM query_user;
DELETE * FROM query_user WHERE query_id > 63;
DELETE FROM query_user WHERE query_id > 63;
SELECT * FROM query_user;
SELECT * FROM query_user;
SELECT * FROM query WHERE id = 158;
DELETE FROM query_user WHERE query_id > 63;
SELECT * FROM query WHERE id = 158;
SELECT * FROM query_user ;
SELECT * FROM query WHERE id > 158 AND query_type = "radius";
SELECT * FROM query WHERE id > 158 AND query_type = 'radius';
DELETE FROM query WHERE id > 158 AND query_type = 'radius';
SELECT * FROM query WHERE id > 158 AND query_type = 'radius';
SELECT * FROM query WHERE id > 158 AND query_type = 'radius';
SELECT * FROM individual_query
;
SELECT * FROM query_user ;
DELETE from query_user WHERE query_id = 162;
SELECT * FROM individual_account where ssn='AAAABBBBCCCCDDDD'
;
\s query_user
\s query_user 
